<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Antventure: Realistic Leaf Edition</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100vw; height: 100vh;
      background: #1e3d59;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    canvas { display: block; width: 100vw; height: 100vh; }
    #overlay, #titleScreen {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.85); color: white;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 10;
    }
    button {
      margin-top: 20px; padding: 10px 20px; font-size: 14px;
      background: #00cec9; border: none; border-radius: 10px; color: white; cursor: pointer;
    }
    #scoreDisplay, #devInfo {
      position: absolute; left: 50%; transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6); color: white;
      padding: 10px 20px; font-size: 12px; border-radius: 10px; z-index: 5;
    }
    #scoreDisplay { top: 10px; }
    #devInfo { bottom: 10px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <div id="overlay">
    <p>The ant has landed on a real banana leaf drifting downriver!</p>
    <p>Touch and drag to guide the ant and dodge the rain!</p>
    <button onclick="startIntro()">Continue</button>
  </div>

  <div id="titleScreen" style="display: none;">
    <h1>ANTVENTURE</h1>
    <button onclick="startGame()">Start Game</button>
  </div>

  <div id="scoreDisplay">Score: 0</div>
  <div id="devInfo">Developed by Satya | mnvdsreddy93@gmail.com</div>

  <audio id="bgm" src="audio/bgm.mp3" autoplay loop muted></audio>
  <audio id="rain" src="audio/rain.mp3" autoplay loop muted></audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const antImg = new Image();
    antImg.src = "assets/ant.png";

    const leafImg = new Image();
    leafImg.src = "assets/banana-leaf.png";

    let W = window.innerWidth, H = window.innerHeight;
    let score = 0, running = false;
    let t = 0;
    let leaf = { x: W / 2, y: H * 0.7, drift: 0 };
    let raindrops = [];

    function resize() {
      W = canvas.width = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }

    function drawWater() {
      const grad = ctx.createLinearGradient(0, 0, 0, H);
      grad.addColorStop(0, '#3a7bd5');
      grad.addColorStop(1, '#00d2ff');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, W, H);

      for (let i = 0; i < 20; i++) {
        let y = (i * 30 + (t % 30));
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(W, y + Math.sin(i + t / 500) * 5);
        ctx.strokeStyle = 'rgba(255,255,255,0.03)';
        ctx.stroke();
      }
    }

    function drawLeaf() {
      leaf.drift += 0.02;
      const tilt = Math.sin(leaf.drift) * 0.05;
      const bob = Math.sin(leaf.drift * 1.5) * 3;

      ctx.save();
      ctx.translate(leaf.x, leaf.y + bob);
      ctx.rotate(tilt);
      if (leafImg.complete && leafImg.naturalWidth !== 0) {
        ctx.drawImage(leafImg, -100, -40, 200, 80);
      } else {
        ctx.fillStyle = "#6b8e23";
        ctx.beginPath();
        ctx.ellipse(0, 0, 80, 20, 0, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.restore();
    }

    function drawAnt() {
      if (antImg.complete && antImg.naturalWidth !== 0) {
        ctx.drawImage(antImg, leaf.x - 16, leaf.y - 35, 32, 32);
      } else {
        ctx.fillStyle = "#3e2723";
        ctx.beginPath();
        ctx.arc(leaf.x, leaf.y - 25, 10, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawRain() {
      if (Math.random() < 0.03) {
        raindrops.push({ x: Math.random() * W, y: 0, speed: 2 + Math.random() * 3 });
      }
      ctx.strokeStyle = "rgba(255,255,255,0.5)";
      ctx.lineWidth = 2;
      for (let i = raindrops.length - 1; i >= 0; i--) {
        const r = raindrops[i];
        ctx.beginPath();
        ctx.moveTo(r.x, r.y);
        ctx.lineTo(r.x, r.y + 10);
        ctx.stroke();
        r.y += r.speed;
        if (r.y > H) raindrops.splice(i, 1);
        if (Math.abs(r.x - leaf.x) < 16 && Math.abs(r.y - (leaf.y - 20)) < 16) {
          running = false;
          alert("Game Over! Final Score: " + score);
          location.reload();
        }
      }
    }

    function gameLoop() {
      if (!running) return;
      ctx.clearRect(0, 0, W, H);
      drawWater();
      drawLeaf();
      drawAnt();
      drawRain();
      document.getElementById("scoreDisplay").innerText = "Score: " + score++;
      t += 1;
      requestAnimationFrame(gameLoop);
    }

    function startIntro() {
      document.getElementById("overlay").style.display = "none";
      document.getElementById("titleScreen").style.display = "flex";
    }

    function startGame() {
      document.getElementById("titleScreen").style.display = "none";
      document.getElementById("scoreDisplay").style.display = "block";
      resize();
      running = true;
      document.getElementById("bgm").muted = false;
      document.getElementById("rain").muted = false;
      document.getElementById("bgm").play();
      document.getElementById("rain").play();
      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener("touchmove", (e) => {
      if (!running) return;
      const touch = e.touches[0];
      leaf.x = touch.clientX;
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener("mousemove", (e) => {
      if (!running) return;
      leaf.x = e.clientX;
    });

    window.addEventListener('resize', resize);
    window.addEventListener('load', resize);
  </script>
</body>
</html>
